FROM ghcr.io/ublue-os/ucore-minimal:stable-nvidia

ADD ./files/modules.conf /etc/modules-load.d/k8s.conf
ADD ./files/sysctl.conf /etc/sysctl.d/k8s.conf

RUN dnf install -y \
    iptables \
    iproute-tc \
    kubelet \
    kubeadm \
    kubectl \
    cri-o \
    containernetworking-plugins \
    && dnf clean all

RUN dnf remove -y \
  zram-generator-defaults

RUN systemctl disable firewalld \
    && systemctl enable crio \
    && systemctl enable kubelet
