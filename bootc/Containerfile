FROM ghcr.io/ublue-os/ucore-minimal:stable-nvidia

ADD ./files/modules.conf /etc/modules-load.d/k8s.conf
ADD ./files/sysctl.conf /etc/sysctl.d/k8s.conf

RUN dnf install -y \
    kubernetes1.32 \
    kubernetes1.32-kubeadm \
    kubernetes1.32-client \
    cri-o \
    containernetworking-plugins \
    && dnf clean all

RUN sudo dnf versionlock add kubernetes*-1.32.* cri-o-1.32.*

RUN dnf remove -y \
  zram-generator-defaults

RUN systemctl disable firewalld \
    && systemctl enable crio \
    && systemctl enable kubelet
