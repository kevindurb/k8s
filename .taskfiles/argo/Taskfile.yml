# yaml-language-server: $schema=https://taskfile.dev/schema.json
---
version: '3'

tasks:
  view-app:
    requires:
      vars: [APP]
    cmd: open https://argocd.beaver-cloud.xyz/applications/argocd/{{.APP}}

  refresh-app:
    requires:
      vars: [APP]
    cmd: >
      kubectl annotate -n argocd
      application {{.APP}}
      argocd.argoproj.io/refresh='normal'

  refresh-all: >
    kubectl get applications -n argocd -o name
    | xargs -I % kubectl annotate -n argocd % argocd.argoproj.io/refresh='normal'

  get-initial-admin-password: >
    kubectl get secret -o json -n argocd
    argocd-initial-admin-secret
    | jq -r .data.password
    | base64 --decode
