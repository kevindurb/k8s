# yaml-language-server: $schema=https://taskfile.dev/schema.json
---
version: '3'

vars:
  HOSTS:
    - kube-master-01
    - kube-master-02
    - kube-master-03
    - kube-storage-01
    - kube-storage-02
    - kube-storage-03
    - kube-big-01

tasks:
  upgrade-all-hosts:
    desc: Upgrade bootc and reboot all hosts
    cmds:
      - for: { var: HOSTS }
        cmd: |
          echo "Upgrading {{.ITEM}}..."
          ssh core@{{.ITEM}} 'sudo bootc upgrade && sudo systemctl reboot' || true

  shutdown:
    desc: Shutdown all bootc hosts
    cmds:
      - for: { var: HOSTS }
        cmd: |
          echo "Shutting down {{.ITEM}}..."
          ssh core@{{.ITEM}} 'sudo systemctl poweroff' || true

  reboot:
    desc: Reboot all bootc hosts
    cmds:
      - for: { var: HOSTS }
        cmd: |
          echo "Rebooting {{.ITEM}}..."
          ssh core@{{.ITEM}} 'sudo systemctl reboot' || true
